<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supermercado Secreto - Achadinhos da Shopee</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        shopee: {
                            DEFAULT: '#EE4D2D',
                            hover: '#D03E1F',
                            light: '#FFEEE8'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }

        .discount-badge {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800">

    <!-- Hero Section -->
    <header
        class="bg-gradient-to-r from-shopee to-orange-600 text-white pt-10 pb-16 px-4 text-center relative overflow-hidden">
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10">
        </div>
        <div class="relative max-w-4xl mx-auto z-10">
            <span
                class="bg-white text-shopee font-bold px-3 py-1 rounded-full text-xs uppercase tracking-wider mb-4 inline-block">Resumo
                do Dia</span>
            <h1 class="text-3xl md:text-5xl font-extrabold mb-4 leading-tight">
                Ofertas Exclusivas VIP
            </h1>
            <p class="text-lg mb-6 max-w-2xl mx-auto text-orange-50">
                Separamos os melhores pre√ßos de hoje para voc√™. Aproveite antes que acabem!
            </p>

            <p class="mt-2 text-sm opacity-90 p-4 bg-white/10 rounded-xl inline-block backdrop-blur-sm"
                id="countdown-text">‚ö° Estas ofertas expiram em <span id="timer"
                    class="font-bold font-mono text-xl ml-2">00:00:00</span></p>
        </div>

        <!-- Wave Separator -->
        <div class="absolute bottom-0 left-0 w-full overflow-hidden leading-none rotate-180">
            <svg class="relative block w-[calc(100%+1.3px)] h-[50px] transform rotate-y-180" data-name="Layer 1"
                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
                <path
                    d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z"
                    class="fill-gray-50"></path>
            </svg>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8 -mt-16 relative z-20">

        <div class="flex flex-col lg:flex-row gap-8 items-start">

            <!-- Coluna Principal (Produtos) -->
            <div class="flex-1 w-full">

                <!-- Abas de Navega√ß√£o (Categorias) -->
                <div class="flex flex-wrap gap-2 mb-6 overflow-x-auto pb-2" id="category-tabs">
                    <button
                        class="tab-btn active bg-shopee text-white px-4 py-2 rounded-full text-sm font-bold shadow-sm whitespace-nowrap transition-colors"
                        data-category="all">
                        Tudo
                    </button>
                    <!-- As outras abas ser√£o geradas via JS -->
                </div>

                <!-- Grid de Ofertas -->
                <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Loading Skeleton -->
                    <div class="bg-white rounded-2xl shadow-sm p-4 animate-pulse h-96"></div>
                    <div class="bg-white rounded-2xl shadow-sm p-4 animate-pulse h-96"></div>
                    <div class="bg-white rounded-2xl shadow-sm p-4 animate-pulse h-96"></div>
                </div>
            </div>

            <!-- Sidebar (Lado Direito) -->
            <aside class="w-full lg:w-80 flex-shrink-0 space-y-6">

                <!-- Card 1: Entrar no Grupo (Novo) -->
                <div
                    class="bg-white rounded-3xl p-6 text-center border border-green-100 shadow-md relative overflow-hidden group hover:shadow-xl transition-all">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-green-400 to-green-600"></div>
                    <div class="relative z-10">
                        <div
                            class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-600" fill="currentColor"
                                viewBox="0 0 24 24">
                                <path
                                    d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z" />
                            </svg>
                        </div>
                        <h3 class="text-lg font-bold text-gray-800 mb-1">Grupo VIP Exclusivo</h3>
                        <p class="text-gray-500 mb-4 text-sm">Receba as ofertas em primeira m√£o no seu WhatsApp.</p>
                        <a href="https://chat.whatsapp.com/SEU_LINK_AQUI" target="_blank"
                            class="block w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-xl shadow-sm transform transition hover:-translate-y-1 hover:shadow-green-200">
                            Entrar Agora
                        </a>
                    </div>
                </div>

                <!-- Se√ß√£o de Sugest√£o (Sidebar) -->
                <div
                    class="bg-white rounded-3xl p-6 text-center border border-orange-100 shadow-lg relative overflow-hidden sticky top-6">
                    <div class="relative z-10">
                        <span class="text-3xl mb-3 block">üí°</span>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Busca Personalizada</h3>
                        <p class="text-gray-500 mb-6 text-sm leading-relaxed">
                            N√£o achou o que queria? Pe√ßa um produto e nossa equipe busca o menor pre√ßo para voc√™.
                        </p>
                        <button onclick="pedirProduto()"
                            class="w-full bg-white border-2 border-shopee text-shopee hover:bg-shopee hover:text-white font-bold py-3 px-4 rounded-xl shadow-sm transform transition hover:-translate-y-1 hover:shadow-md text-sm flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                            </svg>
                            Sugerir Produto
                        </button>
                    </div>
                </div>

                <!-- Banner Extra (Opcional - Exemplo de uso da sidebar) -->
                <div
                    class="hidden lg:block bg-gradient-to-r from-blue-500 to-blue-600 rounded-3xl p-6 text-white text-center shadow-md">
                    <p class="font-bold mb-2">Dica do Dia</p>
                    <p class="text-xs opacity-90">Ative as notifica√ß√µes do grupo para n√£o perder nada!</p>
                </div>

            </aside>

        </div>

    </main>

    <footer class="bg-gray-800 text-white py-12 text-center mt-12 mb-20 md:mb-0">
        <p class="text-gray-400">¬© 2024 Achadinhos da Shopee. Todos os direitos reservados.</p>
        <p class="text-xs text-gray-600 mt-2">Somos afiliados Shopee e podemos receber comiss√µes por compras
            qualificadas.</p>
    </footer>

    <!-- Carrega os dados do arquivo JS local (Funciona sem servidor) -->
    <script src="ofertas.js"></script>

    <script>
        // Fun√ß√£o para o bot√£o "Pedir um Produto"
        function pedirProduto() {
            const message = "Ol√°! Tenho uma sugest√£o de produto para voc√™s buscarem ofertas: ";
            const produto = prompt("Qual produto voc√™ sugere para buscarmos? (Ex: Fritadeira, Sab√£o, TV...)");

            if (produto && produto.trim() !== "") {
                const finalMessage = message + " *" + produto + "*";
                const whatsappLink = `https://wa.me/?text=${encodeURIComponent(finalMessage)}`;
                window.open(whatsappLink, '_blank');
            }
        }

        // Helper para obter % de desconto num√©rico
        function getDiscountPercent(p) {
            if (!p.desconto) return 0;
            return parseFloat(p.desconto.replace('%', '')) || 0;
        }

        // Helper para parsear data DD/MM/YYYY HH:MM
        function parseDate(dateStr) {
            if (!dateStr) return 0;
            const [day, month, yearTime] = dateStr.split('/');
            const [year, time] = yearTime.split(' ');
            const [hour, minute] = time.split(':');
            return new Date(year, month - 1, day, hour, minute).getTime();
        }

        // Helper robusto para limpar pre√ßo (remove "A partir de", "R$", espa√ßos)
        function cleanPrice(priceStr) {
            if (!priceStr) return 0;
            return parseFloat(priceStr.replace(/[^0-9,]/g, '').replace(',', '.')) || 0;
        }

        // Fun√ß√£o para carregar os produtos do JS Global
        function loadProducts() {
            try {
                // Verifica se a vari√°vel global foi carregada pelo script ofertas.js
                if (typeof window.ACHADINHOS_OFERTAS !== 'undefined' && Array.isArray(window.ACHADINHOS_OFERTAS)) {
                    let allProducts = window.ACHADINHOS_OFERTAS;

                    // ORDENA√á√ÉO: 
                    // 1¬∫ - Mais Recentes (Data Coleta Desc)
                    // 2¬∫ - Maior % de Desconto (Desc)
                    allProducts.sort((a, b) => {
                        const dateA = parseDate(a.data_coleta);
                        const dateB = parseDate(b.data_coleta);

                        // Diferen√ßa de data
                        if (dateB !== dateA) return dateB - dateA;

                        // Crit√©rio de desempate: % Desconto
                        return getDiscountPercent(b) - getDiscountPercent(a);
                    });

                    renderCategories(allProducts);
                    renderProducts(allProducts);
                } else {
                    throw new Error("Dados n√£o encontrados no arquivo ofertas.js");
                }
            } catch (e) {
                console.error("Erro ao carregar dados:", e);
                document.getElementById('products-grid').innerHTML = `
                    <div class="col-span-full text-center py-10 bg-white rounded-lg shadow">
                        <h3 class="text-xl font-bold text-gray-700">Nenhuma oferta encontrada</h3>
                        <p class="text-gray-500">Verifique se o arquivo <code class="bg-gray-100 px-1">ofertas.js</code> foi gerado pelo script Python.</p>
                        <p class="text-xs text-gray-400 mt-2">Erro: ${e.message}</p>
                    </div>
                `;
            }
        }

        // Renderiza as categorias dinamicamente
        function renderCategories(products) {
            const categories = new Set(products.map(p => p.categoria).filter(Boolean));
            const tabsContainer = document.getElementById('category-tabs');

            // Limpa tabs exceto "Tudo"
            tabsContainer.innerHTML = `
                <button class="tab-btn bg-shopee text-white px-4 py-2 rounded-full text-sm font-bold shadow-sm whitespace-nowrap transition-colors ring-2 ring-transparent focus:outline-none" onclick="filterCategory('all', this)">
                    Todas as Ofertas
                </button>
            `;

            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = "tab-btn bg-white text-gray-600 hover:bg-orange-50 hover:text-shopee px-4 py-2 rounded-full text-sm font-bold shadow-sm whitespace-nowrap transition-colors border border-gray-100";
                btn.innerText = cat;
                btn.onclick = () => filterCategory(cat, btn);
                tabsContainer.appendChild(btn);
            });
        }

        // Filtra os produtos por categoria
        function filterCategory(category, btnElement) {
            // Atualiza estilo dos bot√µes
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-shopee', 'text-white');
                btn.classList.add('bg-white', 'text-gray-600', 'border', 'border-gray-100');
            });
            btnElement.classList.remove('bg-white', 'text-gray-600', 'border', 'border-gray-100');
            btnElement.classList.add('bg-shopee', 'text-white');

            let allProducts = window.ACHADINHOS_OFERTAS;
            // Garante ordena√ß√£o tamb√©m no filtro
            allProducts.sort((a, b) => {
                const dateA = parseDate(a.data_coleta);
                const dateB = parseDate(b.data_coleta);
                if (dateB !== dateA) return dateB - dateA;
                return getDiscountPercent(b) - getDiscountPercent(a);
            });

            if (category === 'all') {
                renderProducts(allProducts);
            } else {
                const filtered = allProducts.filter(p => p.categoria === category);
                renderProducts(filtered);
            }
        }

        // Fun√ß√£o Pedir Produto
        function pedirProduto() {
            const produto = prompt("Qual produto voc√™ est√° procurando? (Ex: Fralda G, Sab√£o Omo...)");
            if (produto && produto.trim() !== "") {
                const texto = `Ol√°! Gostaria de pedir um achadinho de: *${produto}*`;
                const link = `https://wa.me/?text=${encodeURIComponent(texto)}`;
                window.open(link, '_blank');
            }
        }

        function renderProducts(products) {
            const grid = document.getElementById('products-grid');
            grid.innerHTML = ''; // Limpa skeleons

            products.forEach(product => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden group border border-gray-100 flex flex-col";

                // Logica de Exibi√ß√£o Condicional
                const badgeHtml = product.desconto ?
                    `<div class="absolute top-2 right-2 bg-shopee text-white font-bold text-sm px-2 py-1 rounded-lg shadow discount-badge">-${product.desconto} OFF</div>` : '';

                const originalPriceHtml = product.preco_original ?
                    `<p class="text-gray-400 text-sm line-through">${product.preco_original}</p>` : '';

                card.innerHTML = `
                    <div class="relative overflow-hidden aspect-square">
                        <a href="${product.link_afiliado}" target="_blank">
                            <img src="${product.imagem_url}" alt="${product.titulo}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500 cursor-pointer">
                        </a>
                        ${badgeHtml}
                    </div>
                    <div class="p-5 flex-1 flex flex-col">
                        <div class="flex justify-between items-start mb-2">
                             <span class="text-[10px] uppercase font-bold text-gray-400 bg-gray-100 px-2 py-0.5 rounded">${product.loja || 'Shopee'}</span>
                             <div class="flex items-center text-xs text-orange-500 font-semibold">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                </svg>
                                ${product.nota}
                             </div>
                        </div>

                        <a href="${product.link_afiliado}" target="_blank" class="hover:text-shopee transition-colors">
                            <h3 class="font-medium text-gray-800 mb-1 line-clamp-2 leading-snug flex-grow" title="${product.titulo}">${product.titulo}</h3>
                        </a>
                        
                        <p class="text-xs text-gray-500 mb-3">${product.vendas ? product.vendas : ''}</p>

                        <div class="mt-auto">
                            ${originalPriceHtml}
                            <div class="flex items-center gap-2">
                                <p class="text-shopee font-black text-xl leading-tight">${product.preco_promocional}</p>
                            </div>
                        </div>

                        <a href="${product.link_afiliado}" target="_blank" class="mt-4 w-full bg-shopee hover:bg-shopee-hover text-white font-bold py-3 px-4 rounded-xl text-center transform transition active:scale-95 flex items-center justify-center gap-2">
                            <span>VER OFERTA</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                            </svg>
                        </a>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Timer Reverso (Fake Urgency)
        function startTimer() {
            let hours = 23;
            let minutes = 59;
            let seconds = 59;

            // Tenta pegar do localStorage para persistir entre refreshes
            const savedTime = localStorage.getItem('shopee_timer');
            if (savedTime) {
                // L√≥gica simples: reinicia todo dia
                // Para simplificar, vou apenas rodar o timer visual
            }

            const timerElement = document.getElementById('timer');

            setInterval(() => {
                seconds--;
                if (seconds < 0) {
                    seconds = 59;
                    minutes--;
                    if (minutes < 0) {
                        minutes = 59;
                        hours--;
                        if (hours < 0) hours = 23;
                    }
                }

                timerElement.innerText = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }, 1000);
        }

        // Start app
        loadProducts();
        startTimer();

    </script>
</body>

</html>